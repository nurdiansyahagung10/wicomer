{% extends 'layout\base.html' %}
{% load static %}
{% block contains %}
{% load filter_tags %}

<script src="https://cdnjs.cloudflare.com/ajax/libs/bodymovin/5.7.8/lottie.min.js"></script>

<style>
    .form-control:focus {
        border: 1px solid rgba(234, 100, 217, 0.4) !important;
        box-shadow: 0 0 0 4px rgba(234, 100, 217, 0.1) !important;
    }
</style>

<div style="z-index: 999; " id="loadingAnimationcontainer" class="p-5 d-none position-fixed d-flex align-items-center justify-content-center w-100 h-100 bg-white" >
    <div class="rounded-circle overflow-hidden " style="max-width: 400px; max-height: 400px;">
        <div id="loadingAnimation" style="object-fit: cover;"></div>
    </div>
</div>


<div style="height: 100vh;">
    <div class="container h-100">
        <form method="post" class="d-flex flex-column h-100" id="form-checkout">
            {% csrf_token %}
            <div class="d-flex py-3 px-2 position-sticky top-0 bg-white align-items-center justify-content-between">
                <button type="button" class="btn px-0 border-0">
                    <i class="fa-regular fs-5 fa-arrow-left"></i>
                </button>
                <span class="fs-5 fw-bold" id="text-nav">order confirmation</span>
            </div>
            <div class="py-3 border-bottom px-2  ">
                <div class="mb-3 d-flex align-items-center justify-content-between w-100">
                    <span class="fw-bold">Preorder</span>
                    <input type="checkbox" name="preorder" disabled >
                </div>
                <div
                    class="p-2 d-flex align-items-center  justify-content-between border rounded-3">
                        <span class="text-center w-100">none</span>
                </div>

            </div>

            <div class="py-3 px-2 border-bottom ">
                <div class="mb-3 d-flex align-items-center justify-content-between w-100">
                    <span class="fw-bold">Pengiriman</span>
                    <button class="btn border-0 text-white" style="background-color: #0e0d23;">switch</button>
                </div>
                <div
                    class="p-3 d-flex bg-light flex-column border rounded-3">
                            <span>Langsung</span>
                            <span class="small text-secondary">Langsung di kirim ke {{order.address}}</span>
                </div>

            </div>

            <div class="py-3 px-2  bg-white border-bottom">
                <span class="fw-bold">alamat pengiriman</span>
                <h5 class="mt-3">{{address_data.school}} {{address_data.class_school}}</h5>
                <div class="bg-light w-100 p-3 text-secondary mb-2 small rounded-3">
                    <span class="small">tambahkan noted address untuk memudahkan penjual mengantarkan produknya.</span>
                </div>
                <div class="d-flex flex-wrap gap-2">
                    <button class="border btn btn-sm rounded-3 d-flex gap-2 align-items-center"><span><i class="fa-light fa-location-dot"></i></span>switch detail address</button>
                    <button class="border btn btn-sm rounded-3 d-flex gap-2 align-items-center"><span><i
                                class="fa-light fa-note"></i></span>Noted address</button>
                </div>
            </div>
            <div class="py-3 px-2 d-flex align-items-start justify-content-between  bg-white border-bottom">
                <div class="d-flex flex-column">
                    <span class="fw-bold">{{extrax_product_data}}</span>
                    <span>Rp {{extrax_product_data.price}}</span>
                    <div class="d-flex gap-1">
                        <div class="d-flex flex-column">

                            {% for spesification in order.spesification|slice:"-1"|split:"," %}
                            <small>
                                {{spesification}}

                            </small>

                            {% endfor %}
                        </div>
                        <div class="d-flex flex-column">

                            {% for value in order.spesificationvalue|slice:"-1"|split:"," %}
                            <small>: {{value}}</small>

                            {% endfor %}
                        </div>
                    </div>
                </div>


                {% with extrax_product_data.productimage_set.first as image %}
                <div id="{{image.image.url}}" class=" rounded-3 overflow-hidden position-relative"
                    style="flex: 0 0 80px; padding-bottom: 80px; ">
                    <img src="{{image.image.url}}" class="w-100 h-100 position-absolute" style="object-fit: cover;"
                        alt="">
                </div>
                <script>
                    document.getElementById('{{image.image.url}}').addEventListener('click', function () {
                        document.getElementById('{{product}}image').src = "{{image.image.url}}";
                    });
                </script>
                <!-- Use alt text that describes the image -->
                {% endwith %}
            </div>



            <div class="p-3 mt-3 rounded-3 d-flex flex-column border">
                <span class="fw-bold mb-1">Ringkasan pembayaran</span>
                <div style="border-bottom-width: 1px; border-bottom-style: dashed; border-bottom-color: #dee2e6;">
                    <div class="d-flex align-items-center justify-content-between my-2">
                        <small>Price</small>
                        <small>{{extrax_product_data.price}}</small>
                    </div>
                    <div class="d-flex align-items-center justify-content-between my-2">
                        <small>Quantity</small>
                        <small>{{order.quantity}}</small>
                    </div>
                </div>
                <div class="d-flex align-items-center justify-content-between mt-3">
                    <span>Total Pembayaran</span>
                    <input type="number" name="totalharga" style="outline: none; text-align: end;" readonly class="totalprice p-0 flex-fill bg-transparent border-0">

                </div>

            </div>

            <div class=" px-2 flex-fill d-flex align-items-end justify-content-between">

            </div>

        
            <div class=" py-3 mt-3 border-top z-3 position-sticky bg-white bottom-0">
                <div class="mb-3 px-2 d-flex align-items-center justify-content-between">
                <div class=" d-flex flex-column">
                    <small class="text-secondary">Tunai</small>
                    <span>Rp <span class="totalprice_text"></span></span>
                </div>
                    <span class="fs-5"><i class="fa-light fa-ellipsis-vertical"></i></span>
            </div>
                <button class="w-100 btn btn-dark rounded-5" type="button" style="background-color: #0e0d23;"
                     onclick="submit_btn()">
                    Submit
                </button>
            </div>
        </form>
    </div>
</div>


<script>

    function submit_btn() {
        // Menambahkan class overflow-hidden ke body
        document.querySelector('body').classList.add('overflow-hidden');
    
        // Menghapus class d-none dari loadingAnimationcontainer
        document.getElementById('loadingAnimationcontainer').classList.remove('d-none');
    
        // Memuat animasi Lottie
        lottie.loadAnimation({
            container: document.getElementById('loadingAnimation'),
            renderer: 'svg',
            loop: true,
            autoplay: true,
            path: '{% static "ordersuccess.json" %}' // Lokasi file JSON animasi
        });
    
        // Menunda eksekusi submit form selama 5 detik
        setTimeout(function() {
            // Kode yang ingin Anda jalankan setelah delay
            const form = document.getElementById('form-checkout').submit(); // Memanggil metode submit() pada objek form
        }, 3000); // Delay 5 detik (5000 milidetik)
    }
    
    const totalprice = document.querySelector('.totalprice');
    var akumtotalprice = eval(`{{extrax_product_data.price}} * {{order.quantity}}`);
    totalprice.value = akumtotalprice;
    document.querySelector('.totalprice_text').textContent = akumtotalprice;


    function tambah() {
        const hasil = eval(`${quantity.textContent} + 1`);
        quantity.textContent = hasil;
    }
    function kurang() {
        var quantity = document.getElementById('quantity');
        if (quantity.textContent != 1) {
            const hasil = eval(`${quantity.textContent} - 1`);
            quantity.textContent = hasil;
        } else {

        }
    }
</script>
{% endblock contains %}